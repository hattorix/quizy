<%= stylesheet_link_tag 'contents_search'  %>
<div id="screen_title">検索結果</div>
<% if @flg == 0 && @results.size >= 1 %>
  <% if logged_in? %>
      <div class="add_book">
        <span id="bookmark">
          <%= render :partial => "bookmark", :locals => {:question_id => @results,
                                                    :is_bookmark => @is_bookmark_all} %>
        </span>

      <div class="add_book_form">
        <% remote_form_for :question,:url=>{:action => 'add_book',:id => 'all',:results => @results} do -%>
          全てマイブック
          <% books = Book.find(:all, :conditions => ["user_id = ? and name != '自分で登録した問題' and is_smart != 1",
                                                 current_user.id])%>
          <%= select_tag 'add_book_to',
                        options_from_collection_for_select(books,
                                                      :id, :name),
                        :style => 'width: 80px;' %>
          <%= submit_tag '登録',
                       :class => 'button'%>
        <% end -%></div>
      <span id="add_book_message_all"></span>
    </div>
  <% end %>
<% end %>
<div id="main">
  <div id="result_box">
    <div id="result_header"><%=  result_count = (@results == nil) ? 0 : @results.size %> 件の検索結果</div>
    <% if result_count != 0 %>
      <div id="result_table">
      <ul>
        <% @results.each do |result| %>
          <% if @flg == 0 %>
            <div class="question_text">
              <li><%= link_to(truncate(result.question_text, 30),
                           "/quiz/#{result.id}") %>
                <% if logged_in? %>
                  <% @is_bookmark = Bookmark.find(:first, :conditions => ["question_id = ? and user_id = ?",
                                                                    result.id,
                                                                    current_user.id]) %>
                  <% @question_id = result.id %>
                  <span id="bookmark<%= @question_id %>">
                    <%= render :partial => "bookmark", :locals=>{:question_id => @question_id,
                                                           :is_bookmark => @is_bookmark,
                                                           :results => @results} %>
                  </span>
                <% end %>
              </li>
            </div>

            <% if logged_in? %>
              <div class="add_book">
                <div class="add_book_form">
                  <% remote_form_for :question,:url=>{:action => 'add_book', :id => result.id} do -%>
                    マイブック
                    <% books = Book.find(:all, :conditions => ["user_id = ? and name != '自分で登録した問題' and is_smart != 1",
                                                         current_user.id])%>
                    <%= select_tag 'add_book_to',
                                options_from_collection_for_select(books,
                                                               :id, :name),
                               :style => 'width: 80px;' %>
                    <%= submit_tag '登録',
                               :class => 'button'%>
                  <% end -%></div>
                  <span id="add_book_message<%=result.id%>"></span>
                </div>
            <% end %>
            <div class="book_and_test">
              <%= link_to "この問題を含むブックを検索する", :action => 'search_book', :id => result.id %> - 
              <%= link_to "この問題を含むテストを検索する", :action => 'search_exam', :id => result.id %>
            </div>

          <% elsif @flg == 1 %>
            <li>
              <%= link_to(truncate(result.name, 30),
                       :action => 'tag',:id => result.name) %></li>
          <% elsif @flg == 2 %>
            <li>
              <%= link_to(truncate(result.name, 30),
                       "/books/#{result.id}") %></li>
          <% elsif @flg == 3 %>
            <li>
              <%= link_to(truncate(result.name, 30),
                       "/exams/#{result.id}") %></li>
          <% end %>
        <% end %>
      </ul>
    <% end %>
    </div>
  </div>
</div>